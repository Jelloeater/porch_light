version: '3'
includes:
    docker: ./TaskfileDocker.yaml

tasks:
    default:
        desc: Run all the tests
        cmds:
            - git secret reveal -f
            - task: clean
            - task: run
    clean:
        desc: Clean pipenv
        env:
            PIPENV_IGNORE_VIRTUALENVS: 1
        ignore_error: true
        cmds:
            - pipenv uninstall --all
            - pipenv install --dev
    run:
        summary:
            We get our secrets from env vars. These either get loaded by the python module itself, or via GH Actions
        silent: false
        interactive: true
        env:
            PIPENV_VERBOSITY: -1
        cmds:
            - pipenv run isort --recursive --diff .
            - pipenv run black .
            - pipenv run mypy --install-types --non-interactive
            - pipenv run pytest --cov --cov-fail-under=75
#        - pipenv run flake8 # Only be picky during push
