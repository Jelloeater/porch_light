version: '3'
vars:
    IMAGE_NAME: pl_worker
    DOCKER_FILE: Dockerfile

tasks:
    # Docker
    default:
        desc: Build and run Docker image
        dotenv: [ '.env', '{{.ENV}}/.env.', '{{.HOME}}/.env' ] # Setup env vars from file for docker run
        cmds:
            - task: build
            - docker run --env-file .env -d --rm --name {{.IMAGE_NAME}} {{.IMAGE_NAME}}:latest
            - docker logs {{.IMAGE_NAME}}
    run:
        desc: Build and run Docker image
        dotenv: [ '.env', '{{.ENV}}/.env.', '{{.HOME}}/.env' ] # Setup env vars from file for docker run
        cmds:
            - task: build
            - docker run --env-file .env --rm --name {{.IMAGE_NAME}} {{.IMAGE_NAME}}:latest
    # Docker Remote
    purge: docker system prune -a -f --volumes
    build: docker build . -t {{.IMAGE_NAME}}:latest -f {{.DOCKER_FILE}}
    attach: docker attach {{.IMAGE_NAME}}
    kill: docker kill {{.IMAGE_NAME}}
    logs: docker logs {{.IMAGE_NAME}}
